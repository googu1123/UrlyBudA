package egovframework.rte.cms.web;

import java.io.File;
import java.io.FileInputStream;
import java.io.PrintWriter;
import java.text.SimpleDateFormat;
import java.util.List;

import javax.annotation.Resource;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import org.json.simple.JSONArray;
import org.json.simple.JSONObject;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springmodules.validation.commons.DefaultBeanValidator;

import egovframework.rte.cmmn.util.Common;
import egovframework.rte.cmmn.util.ExcelRead;
import egovframework.rte.cmmn.util.Util;
import egovframework.rte.cms.service.TsmService;
import egovframework.rte.cms.service.TsmVO;
import egovframework.rte.fdl.property.EgovPropertyService;

@Controller
//@SessionAttributes(types=BrochureVO.class)
public class CampaignController {

	/** MainService */
	@Resource(name = "tsmService")
	private TsmService tsmService;
	
	/** EgovPropertyService */
	@Resource(name = "propertiesService")
	protected EgovPropertyService propertiesService;
	
	/** Validator */
	@Resource(name = "beanValidator")
	protected DefaultBeanValidator beanValidator;

	//네비 메뉴
	private static int NAVI_NUM = 6;

								
	@RequestMapping("/campaignList.tsis")
	public String campaignList(@ModelAttribute("tsmVO") TsmVO tsmVO, Model model, HttpServletRequest request, HttpServletResponse response, HttpSession session) throws Exception {
	
		try {
			if(Common.sessionCheck(session)){
				//리스트 조회
				int totalCount = tsmService.campaignTotalCnt(tsmVO);
				
				//페이징 처리
				if(Common.pagingOrder(totalCount, tsmVO, model, request)){
					List<TsmVO> campaignList = tsmService.campaignList(tsmVO);
					
					model.addAttribute("use_yn", tsmVO.getUse_yn());
					model.addAttribute("subject", tsmVO.getSubject());
					model.addAttribute("campaignList", campaignList);
					
				} else {
					throw new Exception("ERR_PAGING_FAIL");
				}
				model.addAttribute("navi", NAVI_NUM);
				return "/tsm/tsm_0601";
			} else {
				model.addAttribute("returnMsg", propertiesService.getString("sessionFail"));
				model.addAttribute("returnUrl", "login.tsis");
				return "/common/link";
			}
			
		} catch (Exception e) {
			e.printStackTrace();
			return "/common/500";
		}
		
	}
	
	//메시지 규격관리 상세
	@RequestMapping("/campaignDetail.tsis")
	public String msgStandardDetail(@ModelAttribute("tsmVO") TsmVO tsmVO, Model model, HttpServletRequest request, HttpServletResponse response, HttpSession session) throws Exception {
		
		
		//System.out.println(">>>>"+tsmVO.toString());
		if(Common.sessionCheck(session)){
			TsmVO campaignDetail = tsmService.campaignDetail(tsmVO);
			
			model.addAttribute("navi", NAVI_NUM);
			model.addAttribute("len_subject", 100);
			model.addAttribute("len_add_content", 100);
			model.addAttribute("len_content", 2048);
			model.addAttribute("view", campaignDetail);
			
			return "/tsm/tsm_060101";
			
		} else {
			model.addAttribute("returnMsg", propertiesService.getString("sessionFail"));
			model.addAttribute("returnUrl", "login.tsis");
			return "/common/link";
		}
	}

}

